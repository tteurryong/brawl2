<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ë¸Œë¡¤ë¡œê·¸ í…ìŠ¤íŠ¸ ì „íˆ¬ with ë„íŠ¸ & íš¨ê³¼ìŒ</title>
<style>
  body { font-family: 'Arial', sans-serif; max-width: 640px; margin: 20px auto; }
  #gameArea { display: flex; justify-content: space-around; align-items: center; margin-bottom: 10px; }
  canvas { border: 1px solid #ccc; image-rendering: pixelated; }
  #log { white-space: pre-line; border: 1px solid #ccc; padding: 10px; height: 250px; overflow-y: auto; background: #f9f9f9; margin-bottom: 10px; }
  button { margin: 5px; padding: 10px 20px; font-size: 16px; }
</style>
</head>
<body>

<h1>ë¸Œë¡¤ë¡œê·¸ í…ìŠ¤íŠ¸ ì „íˆ¬</h1>

<div id="gameArea">
  <div>
    <canvas id="playerCanvas" width="64" height="64"></canvas>
    <div style="text-align:center;">í”Œë ˆì´ì–´: ì—ë“œê±°</div>
    <div id="playerHp"></div>
  </div>
  <div>
    <canvas id="enemyCanvas" width="64" height="64"></canvas>
    <div style="text-align:center;">ì : íŒ½</div>
    <div id="enemyHp"></div>
  </div>
</div>

<div id="log">ê²Œì„ ì‹œì‘í•˜ë ¤ë©´ ì•„ë˜ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</div>

<button id="startBtn">ê²Œì„ ì‹œì‘</button>

<script>
  // ë„íŠ¸ ì´ë¯¸ì§€ ê·¸ë¦¬ê¸° í•¨ìˆ˜ (16x16 í”½ì…€ ë„íŠ¸ â†’ 64x64 ìº”ë²„ìŠ¤ì— í™•ëŒ€)
  function drawEdgar(ctx) {
    const pixels = [
      "0000440000004400",
      "0044444400444440",
      "0444444444444444",
      "0444477444444774",
      "0444477444444774",
      "0044444400444440",
      "0000440000004400",
      "0000000000000000",
      "0044440000444400",
      "0444444004444440",
      "0444444004444440",
      "0044440000444400",
      "0004400000044000",
      "0004400000044000",
      "0000000000000000",
      "0000000000000000"
    ];
    const colorMap = {
      "0": "#00000000", // íˆ¬ëª…
      "4": "#3333FF",   // íŒŒë€ìƒ‰
      "7": "#AAAAFF"    // ì—°í•œ íŒŒë‘
    };
    const pixelSize = 4;
    for(let y=0; y<16; y++) {
      for(let x=0; x<16; x++) {
        let c = pixels[y][x];
        if(c !== "0") {
          ctx.fillStyle = colorMap[c];
          ctx.fillRect(x*pixelSize, y*pixelSize, pixelSize, pixelSize);
        }
      }
    }
  }

  function drawPenny(ctx) {
    const pixels = [
      "0000666600666600",
      "0066666666666660",
      "0666666666666666",
      "0666699666669996",
      "0666699666669996",
      "0066666600666660",
      "0000666600666600",
      "0000000000000000",
      "0066660000666600",
      "0666666006666660",
      "0666666006666660",
      "0066660000666600",
      "0006600000066000",
      "0006600000066000",
      "0000000000000000",
      "0000000000000000"
    ];
    const colorMap = {
      "0": "#00000000",
      "6": "#FF9933", // ì£¼í™©ìƒ‰
      "9": "#FFCC66"  // ì—°í•œ ì£¼í™©
    };
    const pixelSize = 4;
    for(let y=0; y<16; y++) {
      for(let x=0; x<16; x++) {
        let c = pixels[y][x];
        if(c !== "0") {
          ctx.fillStyle = colorMap[c];
          ctx.fillRect(x*pixelSize, y*pixelSize, pixelSize, pixelSize);
        }
      }
    }
  }

  // íš¨ê³¼ìŒ ìƒì„± í•¨ìˆ˜ (ê°„ë‹¨í•œ ë¹„í”„ìŒ)
  function playSound(freq=440, duration=200) {
    if(!window.AudioContext && !window.webkitAudioContext) return; // ì§€ì› ì•ˆí•  ë•Œ ë¬´ì‹œ
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const ctx = new AudioContext();
    const oscillator = ctx.createOscillator();
    const gainNode = ctx.createGain();

    oscillator.connect(gainNode);
    gainNode.connect(ctx.destination);

    oscillator.type = "square";
    oscillator.frequency.value = freq;
    oscillator.start();

    gainNode.gain.setValueAtTime(0.1, ctx.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.00001, ctx.currentTime + duration/1000);

    oscillator.stop(ctx.currentTime + duration/1000);
  }

  // ë¸Œë¡¤ëŸ¬ í´ë˜ìŠ¤ ì •ì˜
  class Brawler {
    constructor(name, maxHp, attack, superAttack, description) {
      this.name = name;
      this.maxHp = maxHp;
      this.hp = maxHp;
      this.attack = attack;
      this.superAttack = superAttack;
      this.description = description;
      this.superReady = true;
    }

    normalAttack(target) {
      target.hp -= this.attack;
      if(target.hp < 0) target.hp = 0;
      playSound(440, 150);
      return `${this.name}ê°€ ${target.name}ì—ê²Œ ${this.attack}ì˜ í”¼í•´ë¥¼ ì…í˜”ìŠµë‹ˆë‹¤. (${target.hp} HP ë‚¨ìŒ)`;
    }

    useSuper(target) {
      target.hp -= this.superAttack;
      if(target.hp < 0) target.hp = 0;
      this.superReady = false;
      playSound(880, 300);
      return `${this.name}ê°€ ìŠˆí¼ ê³µê²©ìœ¼ë¡œ ${target.name}ì—ê²Œ ${this.superAttack}ì˜ í”¼í•´ë¥¼ ì…í˜”ìŠµë‹ˆë‹¤! (${target.hp} HP ë‚¨ìŒ)`;
    }

    isAlive() {
      return this.hp > 0;
    }

    reset() {
      this.hp = this.maxHp;
      this.superReady = true;
    }
  }

  // ê¸°ë³¸ ë¸Œë¡¤ëŸ¬ ìƒì„±
  const edgarBase = new Brawler("ì—ë“œê±°", 6600, 1080, 675, "ë¯¼ì²©í•œ ê·¼ì ‘ ì „íˆ¬ ì „ë¬¸ê°€");
  const pennyBase = new Brawler("íŒ½", 2800, 500, 700, "ì›ê±°ë¦¬ í­íƒ„ ê³µê²© ì „ë¬¸ê°€");

  // ìŠ¤í…Œì´ì§€ë³„ ì  ìŠ¤ì¼€ì¼ë§
  function scaleEnemy(base, stage) {
    return new Brawler(
      base.name,
      base.maxHp + stage * 100,
      base.attack + stage * 20,
      base.superAttack + stage * 15,
      base.description
    );
  }

  // UI ìš”ì†Œ
  const playerCanvas = document.getElementById("playerCanvas");
  const enemyCanvas = document.getElementById("enemyCanvas");
  const playerCtx = playerCanvas.getContext("2d");
  const enemyCtx = enemyCanvas.getContext("2d");
  const logEl = document.getElementById("log");
  const playerHpEl = document.getElementById("playerHp");
  const enemyHpEl = document.getElementById("enemyHp");
  const startBtn = document.getElementById("startBtn");

  let player, enemy, stage, turn;

  function appendLog(text) {
    logEl.textContent += "\n" + text;
    logEl.scrollTop = logEl.scrollHeight;
  }

  function updateHp() {
    playerHpEl.textContent = `HP: ${player.hp} / ${player.maxHp}`;
    enemyHpEl.textContent = `HP: ${enemy.hp} / ${enemy.maxHp}`;
  }

  function drawCharacters() {
    playerCtx.clearRect(0, 0, playerCanvas.width, playerCanvas.height);
    enemyCtx.clearRect(0, 0, enemyCanvas.width, enemyCanvas.height);
    drawEdgar(playerCtx);
    drawPenny(enemyCtx);
  }

  function resetGame() {
    stage = 1;
    player = new Brawler(edgarBase.name, edgarBase.maxHp, edgarBase.attack, edgarBase.superAttack, edgarBase.description);
    player.reset();
    enemy = scaleEnemy(pennyBase, stage);
    logEl.textContent = "";
    appendLog("ê²Œì„ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤! ìŠ¤í…Œì´ì§€ 1ì…ë‹ˆë‹¤.");
    appendLog(`ì : ${enemy.name} (HP: ${enemy.hp})`);
    appendLog(`í”Œë ˆì´ì–´: ${player.name} (HP: ${player.hp})`);
    updateHp();
    drawCharacters();
    turn = 1;
  }

  function enemyTurn() {
    if (!enemy.isAlive()) return;
    let action;
    if (enemy.superReady && Math.random() < 0.3) {
      action = enemy.useSuper(player);
    } else {
      action = enemy.normalAttack(player);
    }
    appendLog("[ì  í„´] " + action);
    updateHp();
  }

  function playerTurn() {
    if (!player.isAlive() || !enemy.isAlive()) return;

    let action;
    if (player.superReady && Math.random() < 0.3) {
      action = player.useSuper(enemy);
    } else {
      action = player.normalAttack(enemy);
    }
    appendLog("[í”Œë ˆì´ì–´ í„´] " + action);
    updateHp();
  }

  function nextTurn() {
    appendLog(`\n-- í„´ ${turn} ì‹œì‘ --`);
    playerTurn();

    if (!enemy.isAlive()) {
      appendLog(`ğŸ‰ ${enemy.name}ë¥¼ ì“°ëŸ¬ëœ¨ë ¸ìŠµë‹ˆë‹¤! ìŠ¤í…Œì´ì§€ ${stage} í´ë¦¬ì–´!`);
      stage++;
      if (stage > 150) {
        appendLog("ğŸ† ì¶•í•˜í•©ë‹ˆë‹¤! ëª¨ë“  ìŠ¤í…Œì´ì§€ë¥¼ í´ë¦¬ì–´í–ˆìŠµë‹ˆë‹¤!");
        startBtn.disabled = false;
        return;
      }
      enemy = scaleEnemy(pennyBase, stage);
      player.reset();
      appendLog(`\në‹¤ìŒ ìŠ¤í…Œì´ì§€ ${stage} ì‹œì‘! ì : ${enemy.name} (HP: ${enemy.hp})`);
      updateHp();
      turn = 1;
      drawCharacters();
      setTimeout(nextTurn, 1500);
      return;
    }

    enemyTurn();

    if (!player.isAlive()) {
      appendLog(`ğŸ’€ ${player.name}ê°€ íŒ¨ë°°í–ˆìŠµë‹ˆë‹¤... ê²Œì„ ì˜¤ë²„.`);
      startBtn.disabled = false;
      return;
    }

    turn++;
    setTimeout(nextTurn, 1500);
  }

  startBtn.addEventListener("click", () => {
    resetGame();
    startBtn.disabled = true;
    setTimeout(nextTurn, 1000);
  });
</script>

</body>
</html>
